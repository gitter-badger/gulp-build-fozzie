'use strict';function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var gulp=require('gulp'),cache=require('gulp-cached'),plumber=require('gulp-plumber'),gulpif=require('gulp-if'),size=require('gulp-size'),runSequence=require('run-sequence'),exorcist=require('exorcist'),eslint=require('gulp-eslint'),jest=require('jest-cli'),path=require('path'),browserify=require('browserify'),babelify=require('babelify'),source=require('vinyl-source-stream'),buffer=require('vinyl-buffer'),sourcemaps=require('gulp-sourcemaps'),uglify=require('gulp-uglify'),rename=require('gulp-rename'),rev=require('gulp-rev'),config=require('../config'),pathBuilder=require('../pathBuilder');gulp.task('scripts',function(a){runSequence('scripts:lint','scripts:test','scripts:bundle',a)}),gulp.task('scripts:lint',function(){return gulp.src([pathBuilder.jsSrcDir+'/**/*.js'].concat(_toConsumableArray(config.js.lintPaths))).pipe(cache('scripts-lint')).pipe(plumber(config.gulp.onError)).pipe(eslint()).pipe(eslint.format()).pipe(eslint.failAfterError())}),gulp.task('scripts:test',function(a){jest.runCLI({},[path.resolve(process.cwd())],function(){return a()})}),gulp.task('scripts:bundle',['clean:scripts'],function(){return browserify(pathBuilder.jsSrcDir+'/'+config.js.srcFile,{debug:config.isDev}).transform(babelify).bundle().pipe(plumber({errorHandler:config.gulp.onError})).pipe(gulpif(config.isDev,exorcist(pathBuilder.jsDistDir+'/'+config.js.distFile+'.map'))).pipe(source(config.js.distFile)).pipe(buffer()).pipe(gulp.dest(pathBuilder.jsDistDir)).pipe(gulpif(config.misc.showFileSize,size({title:'Bundled JS Report \u2013 unminified build \u2013',showFiles:config.misc.showFiles}))).pipe(gulpif(config.isDev,sourcemaps.init({loadMaps:!0}))).pipe(uglify({output:{quote_keys:!0}})).pipe(gulpif(config.docs.outputAssets,gulp.dest(pathBuilder.docsJsDistDir))).pipe(gulpif(config.js.applyRevision,rev())).pipe(rename({suffix:'.min'})).pipe(gulpif(config.misc.showFileSize,size({title:'Bundled JS Report \u2013 minified build \u2013',showFiles:config.misc.showFiles}))).pipe(gulpif(config.isDev,sourcemaps.write('.'))).pipe(gulp.dest(pathBuilder.jsDistDir))});